<!DOCTYPE html>
<html>
<head>
<title>XRX++ Unit Tests - xrx.mvc.Controller</title>
<script type="text/javascript" src="../../../lib/jssaxparser/SAXException.js"></script>
<script type="text/javascript" src="../../../lib/jssaxparser/AttributesImpl.js"></script>
<script type="text/javascript" src="../../../lib/jssaxparser/LocatorImpls.js"></script>
<script type="text/javascript" src="../../../lib/jssaxparser/NamespaceSupport.js"></script>
<script type="text/javascript" src="../../../lib/jssaxparser/sax.js"></script>
<script type="text/javascript" src="../../../lib/jssaxparser/DefaultHandlers.js"></script>
<script src='../../../lib/closure-library/closure/goog/base.js'></script>
<script src='../../deps.js'></script>
<script type="text/javascript">
  goog.require('goog.array');
  goog.require('goog.dom.DomHelper');
  goog.require('goog.dom.dataset');
  goog.require('goog.testing.jsunit');
  goog.require('xrx');
  goog.require('xrx.mvc');
  goog.require('xrx.mvc.Mvc');
  goog.require('xrx.mvc.Controller');
</script>
</head>
<body>

<!-- template used to create a new test -->
<div id="template" style="display:none">
  <div id="i[%]" class="xrx-mvc-instance[%]">&lt;data&gt;&lt;a/&gt;&lt;b/&gt;&lt;c/&gt;&lt;/data&gt;</div>
  <div id="b[%]1" class="xrx-mvc-bind[%]" data-xrx-ref="xrx:instance('i[%]')//a"></div>
  <div id="b[%]2" class="xrx-mvc-bind[%]" data-xrx-ref="xrx:instance('i[%]')//b"></div>
  <div id="b[%]3" class="xrx-mvc-bind[%]" data-xrx-ref="xrx:instance('i[%]')//c"></div>
  <pre id="c[%]1" class="xrx-widget-console[%]" data-xrx-bind="b[%]1"></pre>
  <pre id="c[%]2" class="xrx-widget-console[%]" data-xrx-bind="b[%]2"></pre>
  <pre id="c[%]3" class="xrx-widget-console[%]" data-xrx-bind="b[%]3"></pre>
</div>

<div id="test01"></div>

<script type="text/javascript">


function prepareTest(testId) {
  var template = goog.dom.getElement('template').cloneNode(true);
  template.id = template.id + testId;
  var testDiv = goog.dom.getElement('test' + testId);
  var children = goog.dom.getChildren(template);
  var id;
  var clas;
  var ref;
  var bind;
  goog.array.forEach(children, function(e, i, a) {
    id = e.id.replace('[%]', testId);
    e.id = id;
    clas = goog.dom.classes.get(e)[0];
    goog.dom.classes.remove(e, clas)
    goog.dom.classes.set(e, clas.replace('[%]', ''));
    ref = goog.dom.dataset.get(e, 'xrxRef');
    if (ref) goog.dom.dataset.set(e, 'xrxRef', ref.replace('[%]', testId));
    bind = goog.dom.dataset.get(e, 'xrxBind');
    if (bind) goog.dom.dataset.set(e, 'xrxBind', bind.replace('[%]', testId));
  });
  goog.dom.append(testDiv, template);
  xrx.mvc.Mvc.install(testDiv);
};



function test01RemoveEmptyTag() {
  var testId = '01';
  var cons;
  var token;
  prepareTest(testId);

  // remove last console widget
  cons = xrx.mvc.getComponent('c' + testId + '3');
  token = cons.getNode().getToken();
  xrx.mvc.Controller.removeEmptyTag(cons, cons.getNode(), token);
  assertEquals('<data><a/><b/></data>', xrx.mvc.getComponent('i' + testId).xml());

  // remove middle console widget
  cons = xrx.mvc.getComponent('c' + testId + '2');
  token = cons.getNode().getToken();
  xrx.mvc.Controller.removeEmptyTag(cons, cons.getNode(), token);
  assertEquals('<data><a/></data>', xrx.mvc.getComponent('i' + testId).xml());

  // remove first console widget
  cons = xrx.mvc.getComponent('c' + testId + '1');
  token = cons.getNode().getToken();
  xrx.mvc.Controller.removeEmptyTag(cons, cons.getNode(), token);
  assertEquals('<data></data>', xrx.mvc.getComponent('i' + testId).xml());
};



</script>

<script>
  xrx.install();
</script>

</body>
</html>
